<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KW Explore CGI — How Do I Reach My Income Goal</title>
  <meta name="description" content="Enter your profit goal and inputs, receive a one-page PDF with calls, appointments, listings, sales, and GCI targets." />
  <style>
    :root { --kw:#C70000; --bg:#111; --panel:#1a1a1a; --line:#2a2a2a; --text:#eee; --muted:#aaa; --grey:#2b2b2b; }
    * { box-sizing: border-box; }
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--text); min-height:100vh; margin:0; display:grid; place-items:center; padding:24px; }
    .app { width:100%; max-width:980px; background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:22px; box-shadow:0 10px 30px rgba(0,0,0,.2); }
    h1 { margin:0 0 4px 0; font-size:24px; line-height:1.2; }
    .brand { color:var(--kw); }
    .tag { color:var(--muted); margin:0 0 16px 0; }

    .tabs { display:flex; flex-wrap:wrap; gap:6px; margin:0 0 12px 0; }
    .tab { padding:8px 12px; border:1px solid var(--line); background:#171717; color:#ddd; border-radius:10px; cursor:pointer; font-size:13px; }
    .tab.active { background:#202020; border-color:#3a3a3a; color:#fff; box-shadow: inset 0 0 0 2px #00000040; }

    .panel { display:none; border:1px solid var(--line); border-radius:12px; padding:14px; background:#171717; }
    .panel.active { display:block; }
    .panel h2 { margin:0 0 8px 0; font-size:16px; color:#ddd; }

    .row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .row-3 { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; }
    label { display:block; font-size:13px; margin:6px 0 4px; color:#ddd; }
    input { width:100%; padding:12px; border-radius:10px; border:1px solid #333; background:var(--grey); color:var(--text); }
    input::placeholder { color:#888; }

    .actions { display:flex; gap:12px; align-items:center; margin-top:14px; }
    .submit { padding:12px 16px; border-radius:12px; border:none; background:var(--kw); color:#fff; font-weight:700; cursor:pointer; }
    .muted { color:var(--muted); font-size:12px; }
    .ok { color:#7cf27c; }
    .err { color:#ff8b8b; }

    @media (max-width:900px){ .row,.row-3 { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="app">
    <h1><span class="brand">KW Explore</span> CGI — How Do I Reach My Income Goal</h1>
    <p class="tag">Your PDF will be emailed to you. Contact Team Leader Dawie at KW Explore for support.</p>

    <div class="tabs" id="tabs">
      <button class="tab active" data-panel="contact">Contact</button>
      <button class="tab" data-panel="profit">Fund Your Life (Profit Goal)</button>
      <button class="tab" data-panel="tax">Tax</button>
      <button class="tab" data-panel="cos">Cost of Sales</button>
      <button class="tab" data-panel="expenses">Expenses</button>
      <button class="tab" data-panel="ratios">Listing Focus & Ratios</button>
      <button class="tab" data-panel="send">Review & Send</button>
    </div>

    <form id="f" autocomplete="on" novalidate>
      <!-- CONTACT -->
      <section class="panel active" id="panel-contact">
        <h2>Contact Details</h2>
        <div class="row">
          <div>
            <label>Name</label>
            <input name="name" required placeholder="e.g., Devin" />
          </div>
          <div>
            <label>Surname</label>
            <input name="surname" required placeholder="e.g., Lohmann" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Cell Number</label>
            <input name="cell" required placeholder="e.g., +27 62 650 2292" />
          </div>
          <div>
            <label>Email Address</label>
            <input type="email" name="email" required placeholder="you@example.com" />
          </div>
        </div>
      </section>

      <!-- PROFIT -->
      <section class="panel" id="panel-profit">
        <h2>Fund Your Life — Profit Goal</h2>
        <label><b>Profit Goal (12 months)</b></label>
        <input name="profitGoal" required inputmode="numeric" placeholder="e.g., 1200000" />
        <div class="muted">How much profit you want in the next 12 months.</div>
      </section>

      <!-- TAX -->
      <section class="panel" id="panel-tax">
        <h2>Tax</h2>
        <div class="row">
          <div>
            <label>Estimated Taxes (year)</label>
            <input name="estimatedTaxes" inputmode="numeric" placeholder="e.g., 300000" />
          </div>
        </div>
      </section>

      <!-- COST OF SALES -->
      <section class="panel" id="panel-cos">
        <h2>Cost of Sales</h2>
        <div class="row-3">
          <div>
            <label>Average Sale Price</label>
            <input name="avgSalePrice" inputmode="numeric" placeholder="e.g., 1300000" />
          </div>
          <div>
            <label>Average Commission %</label>
            <input name="avgCommRate" placeholder="e.g., 5%" />
          </div>
          <div>
            <label>Split to Market Center %</label>
            <input name="splitToMc" placeholder="e.g., 30%" />
          </div>
          <div>
            <label>Company Cap (year)</label>
            <input name="companyCap" inputmode="numeric" placeholder="e.g., 140000" />
          </div>
          <div>
            <label>Franchise Fee %</label>
            <input name="franchiseFeeRate" placeholder="e.g., 8%" />
          </div>
          <div>
            <label>Anticipated Transactions / Year</label>
            <input name="anticTrans" inputmode="numeric" placeholder="e.g., 24" />
          </div>
        </div>
      </section>

      <!-- EXPENSES -->
      <section class="panel" id="panel-expenses">
        <h2>Expenses</h2>
        <div class="row">
          <div>
            <label>Average Operating Expenses / Month</label>
            <input name="expensesPerMonth" inputmode="numeric" placeholder="e.g., 30000" />
          </div>
        </div>
      </section>

      <!-- RATIOS -->
      <section class="panel" id="panel-ratios">
        <h2>Listing Focus & Ratios</h2>
        <div class="row-3">
          <div>
            <label>% of Business that is Seller Focused</label>
            <input name="sellerFocus" placeholder="e.g., 100%" />
          </div>
          <div>
            <label>Listings Taken → Listings Closed %</label>
            <input name="ltToLc" placeholder="e.g., 50%" />
          </div>
          <div>
            <label>Appointments → Listings Taken %</label>
            <input name="laToLt" placeholder="e.g., 30%" />
          </div>
        </div>
      </section>

      <!-- SEND -->
      <section class="panel" id="panel-send">
        <h2>Review & Send</h2>
        <div class="muted">We’ll email your one-page plan as a PDF and CC Dawie for support.</div>
        <div class="actions">
          <button type="submit" id="btn" class="submit">Get My One-Page Plan</button>
          <div id="msg" class="muted"></div>
        </div>
      </section>
    </form>
  </div>

  <script>
    const ENDPOINT = 'https://script.google.com/macros/s/AKfycbwpRWhsAOAcjmP6mNinJ1XV8XlDNr1BMEzAZ0yfnWwN6l79-v9mXTu6J9rG3l8_Aa1E8w/exec';

    // Tabs
    const tabs = document.querySelectorAll('.tab');
    const panels = document.querySelectorAll('.panel');
    tabs.forEach(t => t.addEventListener('click', () => {
      tabs.forEach(x => x.classList.remove('active'));
      t.classList.add('active');
      panels.forEach(p => p.classList.remove('active'));
      const id = 'panel-' + t.dataset.panel;
      document.getElementById(id).classList.add('active');
      const first = document.getElementById(id).querySelector('input');
      if (first) first.focus({preventScroll:true});
    }));

    // Form
    const form = document.getElementById('f');
    const msg  = document.getElementById('msg');
    const btn  = document.getElementById('btn');

    function normaliseCell(v){
      if(!v) return v;
      let s = v.replace(/[^0-9+]/g,'');
      if (s.startsWith('0')) s = '+27' + s.slice(1);
      if (!s.startsWith('+') && s.length === 10 && s[0]==='0') s = '+27' + s.slice(1);
      return s;
    }
    function cleanPayload(obj){
      const out = {};
      for (const [k,v] of Object.entries(obj)){
        if (v == null) continue;
        const s = String(v).trim();
        if (!s) continue;
        out[k] = s;
      }
      return out;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '';
      if (!form.reportValidity()){
        const invalid = form.querySelector(':invalid');
        if (invalid){
          const panel = invalid.closest('.panel');
          if (panel){
            const id = panel.id.replace('panel-','');
            document.querySelector(`.tab[data-panel=\"${id}\"]`).click();
          }
        }
        return;
      }
      const data = Object.fromEntries(new FormData(form).entries());
      data.cell = normaliseCell(data.cell);
      const payload = cleanPayload(data);

      btn.disabled = true;
      btn.textContent = 'Sending...';

      try {
        await fetch(ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify(payload)
        });
        msg.innerHTML = '<span class="ok">Success! Check your inbox for your PDF.</span>';
        form.reset();
      } catch (err) {
        console.error(err);
        msg.innerHTML = '<span class="err">Something went wrong. Please try again.</span>';
      } finally {
        btn.disabled = false;
        btn.textContent = 'Get My One-Page Plan';
      }
    });
  </script>
</body>
</html>
